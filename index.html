<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Couple Income & Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; max-width: 1200px; margin: auto; background: #f5f5f5; }
  h2 { color: #333; text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #eee; }
  input, select, button { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
  input:focus, select:focus { outline: 2px solid #2196f3; }
  button { cursor: pointer; background-color: #4caf50; color: white; border: none; transition: background 0.3s; }
  button:hover { background-color: #45a049; }
  .dashboard { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; width: 100%; }
  .summary { font-weight: bold; flex: 1; min-width: 250px; }
  #dashboardChart { flex: 2; width: 100%; max-width: 700px; max-height: 300px; margin-left: 20px; }
  .income { background-color: #e8f5e9; }
  .expense { background-color: #ffebee; }
  #entriesTable tbody tr:hover { background-color: #f1f1f1; }
  .form-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin-bottom: 10px; }
  .form-row input, .form-row select { flex: 1; min-width: 150px; }
</style>
</head>
<body>

<h2>Income & Expense Tracker</h2>

<div class="dashboard">
  <div class="summary">
    <p>Total Income: <span id="totalIncome">0</span></p>
    <p>Total Expense: <span id="totalExpense">0</span></p>
    <p>Saved Amount: <span id="savedAmount">0</span></p>
  </div>
  <canvas id="dashboardChart"></canvas>
</div>

<h3>Add Entry</h3>
<form id="entryForm">
  <div class="form-row">
    <input type="date" id="date" required>
    <select id="person" required>
      <option value="Miu">Miu</option>
      <option value="Raya">Raya</option>
    </select>
    <select id="type" required>
      <option value="Income">Income</option>
      <option value="Expense">Expense</option>
    </select>
    <select id="category" required>
      <option value="House">House</option>
      <option value="Transport">Transport</option>
      <option value="Personal">Personal</option>
      <option value="General">General</option>
    </select>
  </div>
  <div class="form-row">
    <input type="text" id="description" placeholder="Description">
    <input type="number" id="amount" placeholder="Amount" required>
    <button type="submit">Add Entry</button>
  </div>
</form>

<div class="form-row">
  <label for="monthFilter">Filter by Month:</label>
  <input type="month" id="monthFilter">
  <button onclick="resetMonthData()">Reset Month Data</button>
</div>

<h3>Entries</h3>
<table id="entriesTable">
  <thead>
    <tr><th>Date</th><th>Person</th><th>Type</th><th>Category</th><th>Description</th><th>Amount</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let entries = JSON.parse(localStorage.getItem('entries')) || [];
const password = '12247';
let chart;

function saveEntries() {
  localStorage.setItem('entries', JSON.stringify(entries));
}

function renderTable() {
  const monthFilter = document.getElementById('monthFilter').value;
  entries.sort((a,b) => new Date(a.date) - new Date(b.date));
  const tbody = document.querySelector('#entriesTable tbody');
  tbody.innerHTML = '';

  let totalIncome = 0;
  let totalExpense = 0;

  entries.forEach(e => {
    if(monthFilter && !e.date.startsWith(monthFilter)) return;

    const row = document.createElement('tr');
    row.className = e.type === 'Income' ? 'income' : 'expense';
    row.innerHTML = `<td>${e.date}</td><td>${e.person}</td><td>${e.type}</td><td>${e.category}</td><td>${e.description}</td><td>${e.amount}</td>`;
    tbody.appendChild(row);

    const amt = parseFloat(e.amount);
    if(e.type === 'Income') totalIncome += amt;
    else totalExpense += amt;
  });

  document.getElementById('totalIncome').textContent = totalIncome;
  document.getElementById('totalExpense').textContent = totalExpense;
  document.getElementById('savedAmount').textContent = totalIncome - totalExpense;

  renderChart(totalIncome, totalExpense);
}

function renderChart(income, expense) {
  const ctx = document.getElementById('dashboardChart').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Income', 'Expense', 'Saved'],
      datasets: [{
        label: 'Monthly Totals',
        data: [income, expense, income - expense],
        backgroundColor: ['#4caf50', '#f44336', '#2196f3']
      }]
    },
    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
  });
}

function resetMonthData() {
  const month = document.getElementById('monthFilter').value;
  if(!month) { alert('Please select a month to reset.'); return; }
  const pwd = prompt('Enter password to reset month data:');
  if(pwd !== password) { alert('Incorrect password'); return; }
  entries = entries.filter(e => !e.date.startsWith(month));
  saveEntries();
  renderTable();
  alert('Month data reset successfully');
}

renderTable();

document.getElementById('entryForm').addEventListener('submit', e => {
  e.preventDefault();
  const newEntry = {
    date: document.getElementById('date').value,
    person: document.getElementById('person').value,
    type: document.getElementById('type').value,
    category: document.getElementById('category').value,
    description: document.getElementById('description').value,
    amount: document.getElementById('amount').value
  };

  const duplicate = entries.some(en => en.date === newEntry.date && en.category === newEntry.category);
  if(duplicate && !confirm('An entry with the same date and category exists. Add anyway?')) return;

  entries.push(newEntry);
  saveEntries();
  renderTable();
  document.getElementById('entryForm').reset();
});

document.getElementById('monthFilter').addEventListener('change', renderTable);
</script>

</body>
</html>
